<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ROO AI</title>

  <!-- Google Fonts: JetBrains Mono -->
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- ─────────────  STYLES  ───────────── -->
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}

    /* page shell */
    body{
      font-family:'JetBrains Mono',monospace;
      background:linear-gradient(135deg,#000 0%,#04045E 50%,#023E89 100%);
      min-height:100vh;display:flex;align-items:center;justify-content:center;
      padding:20px;color:#C0C0C0;
    }

    /* glass card */
    .container{
      background:rgba(0,0,0,.8);backdrop-filter:blur(10px);
      border:1px solid #3E84C6;border-radius:20px;
      padding:40px;max-width:600px;width:100%;
      box-shadow:0 20px 40px rgba(0,0,0,.3);position:relative;overflow:hidden;
    }
    .container::before{
      content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(62,132,198,.1),transparent);
      animation:shimmer 3s infinite;
    }
    @keyframes shimmer{0%{left:-100%;}100%{left:100%}}

    /* title */
    h1{
      text-align:center;margin-bottom:30px;font-size:2.5em;font-weight:700;
      background:linear-gradient(45deg,#C0C0C0,#3E84C6);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
      text-shadow:0 0 30px rgba(62,132,198,.5);
      animation:glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow{from{text-shadow:0 0 30px rgba(62,132,198,.5);}
                    to  {text-shadow:0 0 40px rgba(62,132,198,.8)} }

    /* form */
    label{display:block;margin-bottom:10px;font-size:1.1em;font-weight:600;
          text-transform:uppercase;letter-spacing:1px;}
    textarea{
      width:100%;height:120px;padding:15px;
      border:2px solid #3E84C6;border-radius:10px;
      background:rgba(0,0,0,.6);color:#C0C0C0;font-size:15px;resize:vertical;
      margin-bottom:20px;transition:.3s;
    }
    textarea:focus{
      outline:none;border-color:#C0C0C0;
      box-shadow:0 0 20px rgba(192,192,192,.3);transform:translateY(-2px);
    }
    button{
      width:100%;padding:15px 30px;font-size:1.1em;font-weight:600;
      background:linear-gradient(45deg,#023E89,#3E84C6);color:#C0C0C0;
      border:none;border-radius:10px;cursor:pointer;transition:.3s;
      text-transform:uppercase;letter-spacing:1px;position:relative;overflow:hidden;
    }
    button::before{
      content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);
      transition:left .5s;
    }
    button:hover::before{left:100%}
    button:hover{
      transform:translateY(-3px);box-shadow:0 10px 25px rgba(62,132,198,.4);
      background:linear-gradient(45deg,#3E84C6,#023E89);
    }
    button:disabled{opacity:.6;cursor:not-allowed;transform:none}

    /* status + answer */
    #status{margin-top:20px;padding:15px;border-radius:8px;text-align:center;
            min-height:20px;transition:.3s}
    #status:not(:empty){
      background:rgba(62,132,198,.1);border:1px solid #3E84C6;
      animation:pulse 2s infinite;
    }
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}

    #answer{
      margin-top:25px;padding:20px;border-radius:10px;
      background:rgba(0,0,0,.4);border:1px solid #3E84C6;
      line-height:1.6;max-height:400px;overflow-y:auto;
      opacity:0;transform:translateY(20px);transition:.5s;
      white-space:normal;
    }
    #answer:not(:empty){opacity:1;transform:translateY(0)}
    #answer::-webkit-scrollbar{width:8px;}
    #answer::-webkit-scrollbar-thumb{background:#3E84C6;border-radius:4px;}
    #answer::-webkit-scrollbar-thumb:hover{background:#C0C0C0;}
    #answer .md-h2{font-size:1.25em;font-weight:700;margin:14px 0 6px}
    #answer p{margin:6px 0}

    /* metric tiles */
    .metrics{display:flex;flex-wrap:wrap;gap:20px;margin-top:25px;}
    .metric{
      flex:1 1 120px;position:relative;padding:18px 12px 14px;
      border:2px solid currentColor;border-radius:12px;text-align:center;
      background:rgba(0,0,0,.5);backdrop-filter:blur(6px);transition:.25s;
    }
    .metric:hover{transform:translateY(-4px)}
    .metric .value{font-size:1.9em;font-weight:700;}
    .metric .label{font-size:.75em;letter-spacing:1px;text-transform:uppercase;
                   opacity:.75;margin-top:6px;display:block;}
    .metric .bar{position:absolute;left:0;bottom:0;height:4px;background:currentColor;
                 border-radius:0 0 10px 10px;}

    /* loader & success tick */
    .loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(192,192,192,.3);
             border-radius:50%;border-top-color:#3E84C6;animation:spin 1s infinite ease-in-out;}
    @keyframes spin{to{transform:rotate(360deg)}}
    .success{animation:successPulse .6s;}
    @keyframes successPulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}

    @media(max-width:768px){
      .container{padding:30px 20px;margin:10px}
      h1{font-size:2em}
      textarea{height:100px}
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ROO AI</h1>

    <label for="idea">Your Idea</label>
    <textarea id="idea" placeholder="Describe your startup idea in detail..."></textarea>

    <button id="send">Evaluate Idea</button>

    <div id="status"></div>
    <div id="scores" class="metrics"></div>
    <div id="answer"></div>
  </div>

  <!-- ─────────────  SCRIPT  ───────────── -->
  <script>
    const SUBMIT_URL = 'https://benzh88.app.n8n.cloud/webhook/6b09d0aa-a903-4239-a2bb-9cbff340c34a';
    const RESULT_URL = 'https://benzh88.app.n8n.cloud/webhook/a6e524b5-b6f5-452a-a7bd-82771d08c8af/result/';

    const hslForScore = s => `hsl(${Math.max(0, Math.min(120, s))}, 70%, 50%)`;

    function renderScores(scores){
      const wrap = document.getElementById('scores');
      wrap.innerHTML = '';
      if(!scores) return;

      Object.entries(scores).forEach(([label,val])=>{
        const tile = document.createElement('div');
        tile.className = 'metric';
        tile.style.color = hslForScore(val);

        tile.innerHTML = `
          <span class="value">${Number(val).toFixed(1)}</span>
          <span class="label">${label}</span>
          <div class="bar" style="width:${val}%"></div>`;
        wrap.appendChild(tile);
      });
    }

    function extractBrief(text){
      const marker = '## Snapshot';
      const idx    = text.indexOf(marker);
      return idx === -1 ? text : text.slice(idx).trimStart();
    }

    // Escape HTML to keep output safe
    function escapeHTML(s){
      return s.replace(/&/g,'&amp;')
              .replace(/</g,'&lt;')
              .replace(/>/g,'&gt;')
              .replace(/"/g,'&quot;')
              .replace(/'/g,'&#39;');
    }

    // Convert "## " lines into styled headings (remove hashes)
    function formatBriefToHTML(text){
      const lines = text.split(/\r?\n/);
      const html = lines.map(line=>{
        if(/^##\s+/.test(line)){
          const title = escapeHTML(line.replace(/^##\s+/, '').trim());
          return `<div class="md-h2">${title}</div>`;
        }
        if(line.trim()==='') return '';
        return `<p>${escapeHTML(line)}</p>`;
      }).join('');
      return html;
    }

    document.getElementById('send').onclick = async () => {
      const idea = document.getElementById('idea').value.trim();
      if(!idea) return alert('Please type an idea first!');

      const btn    = document.getElementById('send');
      const status = document.getElementById('status');
      const answer = document.getElementById('answer');
      const scores = document.getElementById('scores');

      scores.innerHTML = '';
      answer.textContent = '';
      status.innerHTML  = '<span class="loading"></span> Submitting your idea...';
      btn.disabled = true; btn.textContent = 'Evaluating...';

      try{
        const r1 = await fetch(SUBMIT_URL,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({ idea })
        });
        const { jobId } = await r1.json();
        if(!jobId) throw new Error('Submission failed ☹︎');

        await new Promise(res=>setTimeout(res,1500));

        let done=false, tries=0;
        while(!done && tries<60){
          const url = RESULT_URL + jobId + `?poll=${tries}`;
          const r2  = await fetch(url, { cache: 'no-store' });

          if (r2.status !== 304) {
            const raw  = await r2.json();
            const data = Array.isArray(raw)?raw[0]:raw;

            if(data.status === 'done'){
              done = true;
              status.innerHTML = '<span class="success">✓</span> Evaluation completed!';
              renderScores(data.scores);
              const brief = extractBrief(data.brief || '');
              answer.innerHTML = formatBriefToHTML(brief);
              break;
            }
          }

          const intervalMs = (tries === 0 ? 10000 : 30000);
          status.innerHTML = `<span class="loading"></span> Working...`;
          await new Promise(res=>setTimeout(res, intervalMs));
          tries++;
        }
        if(!done) status.textContent = 'Timed out after 10 minutes ⏱';

      }catch(err){
        status.textContent = `Error: ${err.message}`;
      }finally{
        btn.disabled = false; btn.textContent = 'Evaluate Idea';
      }
    };

    document.getElementById('idea').addEventListener('keydown',e=>{
      if(e.key==='Enter' && e.ctrlKey) document.getElementById('send').click();
    });
  </script>
</body>
</html>
